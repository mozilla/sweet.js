"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializer = exports.makeDeserializer = undefined;

var _transitJs = require("transit-js");

var _transitJs2 = _interopRequireDefault(_transitJs);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _symbol = require("./symbol");

var _tokenizer = require("shift-parser/dist/tokenizer");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let typeMap_630 = [_tokenizer.TokenType.STRING, _tokenizer.TokenType.EOS, _tokenizer.TokenType.LPAREN, _tokenizer.TokenType.RPAREN, _tokenizer.TokenType.LBRACK, _tokenizer.TokenType.RBRACK, _tokenizer.TokenType.LBRACE, _tokenizer.TokenType.RBRACE, _tokenizer.TokenType.COLON, _tokenizer.TokenType.SEMICOLON, _tokenizer.TokenType.PERIOD, _tokenizer.TokenType.ELLIPSIS, _tokenizer.TokenType.ARROW, _tokenizer.TokenType.CONDITIONAL, _tokenizer.TokenType.INC, _tokenizer.TokenType.DEC, _tokenizer.TokenType.ASSIGN, _tokenizer.TokenType.ASSIGN_BIT_OR, _tokenizer.TokenType.ASSIGN_BIT_XOR, _tokenizer.TokenType.ASSIGN_BIT_AND, _tokenizer.TokenType.ASSIGN_SHL, _tokenizer.TokenType.ASSIGN_SHR, _tokenizer.TokenType.ASSIGN_SHR_UNSIGNED, _tokenizer.TokenType.ASSIGN_ADD, _tokenizer.TokenType.ASSIGN_SUB, _tokenizer.TokenType.ASSIGN_MUL, _tokenizer.TokenType.ASSIGN_DIV, _tokenizer.TokenType.ASSIGN_MOD, _tokenizer.TokenType.COMMA, _tokenizer.TokenType.OR, _tokenizer.TokenType.AND, _tokenizer.TokenType.BIT_OR, _tokenizer.TokenType.BIT_XOR, _tokenizer.TokenType.BIT_AND, _tokenizer.TokenType.SHL, _tokenizer.TokenType.SHR, _tokenizer.TokenType.SHR_UNSIGNED, _tokenizer.TokenType.ADD, _tokenizer.TokenType.SUB, _tokenizer.TokenType.MUL, _tokenizer.TokenType.DIV, _tokenizer.TokenType.MOD, _tokenizer.TokenType.EQ, _tokenizer.TokenType.NE, _tokenizer.TokenType.EQ_STRICT, _tokenizer.TokenType.NE_STRICT, _tokenizer.TokenType.LT, _tokenizer.TokenType.GT, _tokenizer.TokenType.LTE, _tokenizer.TokenType.GTE, _tokenizer.TokenType.INSTANCEOF, _tokenizer.TokenType.IN, _tokenizer.TokenType.NOT, _tokenizer.TokenType.BIT_NOT, _tokenizer.TokenType.AWAIT, _tokenizer.TokenType.DELETE, _tokenizer.TokenType.TYPEOF, _tokenizer.TokenType.VOID, _tokenizer.TokenType.BREAK, _tokenizer.TokenType.CASE, _tokenizer.TokenType.CATCH, _tokenizer.TokenType.CLASS, _tokenizer.TokenType.CONTINUE, _tokenizer.TokenType.DEBUGGER, _tokenizer.TokenType.DEFAULT, _tokenizer.TokenType.DO, _tokenizer.TokenType.ELSE, _tokenizer.TokenType.EXPORT, _tokenizer.TokenType.EXTENDS, _tokenizer.TokenType.FINALLY, _tokenizer.TokenType.FOR, _tokenizer.TokenType.FUNCTION, _tokenizer.TokenType.IF, _tokenizer.TokenType.IMPORT, _tokenizer.TokenType.LET, _tokenizer.TokenType.NEW, _tokenizer.TokenType.RETURN, _tokenizer.TokenType.SUPER, _tokenizer.TokenType.SWITCH, _tokenizer.TokenType.THIS, _tokenizer.TokenType.THROW, _tokenizer.TokenType.TRY, _tokenizer.TokenType.VAR, _tokenizer.TokenType.WHILE, _tokenizer.TokenType.WITH, _tokenizer.TokenType.NULL, _tokenizer.TokenType.TRUE, _tokenizer.TokenType.FALSE, _tokenizer.TokenType.YIELD, _tokenizer.TokenType.NUMBER, _tokenizer.TokenType.STRING, _tokenizer.TokenType.REGEXP, _tokenizer.TokenType.IDENTIFIER, _tokenizer.TokenType.CONST, _tokenizer.TokenType.TEMPLATE, _tokenizer.TokenType.ILLEGAL];
let ListHandler_631 = _transitJs2.default.makeWriteHandler({ tag: () => "array", rep: v_637 => v_637 });
let MapHandler_632 = _transitJs2.default.makeWriteHandler({ tag: function tag(v_638) {
    return "map";
  }, rep: function rep(v_639) {
    return v_639;
  }, stringRep: function stringRep(v_640) {
    return null;
  } });
let SyntaxHandler_633 = _transitJs2.default.makeWriteHandler({ tag: () => "stx", rep: v_641 => {
    if (_immutable.List.isList(v_641.token)) {
      return [v_641.token, v_641.scopesets];
    } else {
      let t = _transitJs2.default.objectToMap(v_641.token);
      t.set("type", typeMap_630.indexOf(v_641.token.type));
      return [t, v_641.scopesets];
    }
  } });
let SymbolHandler_634 = _transitJs2.default.makeWriteHandler({ tag: () => "symb", rep: v_642 => [v_642.name] });
let writer_635 = _transitJs2.default.writer("json", { handlers: _transitJs2.default.map([_immutable.List, ListHandler_631, _immutable.Map, MapHandler_632, _syntax2.default, SyntaxHandler_633, _symbol.SymbolClass, SymbolHandler_634]) });
function makeReader_636(bindings_643) {
  return _transitJs2.default.reader("json", { arrayBuilder: { init: node_644 => (0, _immutable.List)().asMutable(), add: (ret_645, val_646, node_647) => ret_645.push(val_646), finalize: (ret_648, node_649) => ret_648.asImmutable(), fromArray: (arr_650, node_651) => (0, _immutable.List)(arr_650) }, mapBuilder: { init: function init(node_652) {
        return (0, _immutable.Map)().asMutable();
      }, add: function add(ret_653, key_654, val_655, node_656) {
        return ret_653.set(key_654, val_655);
      }, finalize: function finalize(ret_657, node_658) {
        return ret_657.asImmutable();
      } }, handlers: { stx: rep_659 => {
        let scopesets_660 = _transitJs2.default.mapToObject(rep_659[1]);
        if (_immutable.List.isList(rep_659[0])) {
          let token = rep_659[0];
          return new _syntax2.default(token, { bindings: bindings_643, scopesets: scopesets_660 });
        } else {
          let token = _transitJs2.default.mapToObject(rep_659[0]);
          token.type = typeMap_630[rep_659[0].get("type")];
          token.slice = rep_659[0].has("slice") ? _transitJs2.default.mapToObject(rep_659[0].get("slice")) : undefined;
          if (token.slice) {
            token.slice.startLocation = _transitJs2.default.mapToObject(token.slice.startLocation);
          }
          return new _syntax2.default(token, { bindings: bindings_643, scopesets: scopesets_660 });
        }
      }, symb: rep_661 => {
        return (0, _symbol.Symbol)(rep_661[0]);
      } } });
}
exports.makeDeserializer = makeReader_636;
exports.serializer = writer_635;
//# sourceMappingURL=data:application/json;base64,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QUwsQ0FBWSxRQUFRLENBQVIsQ0FBWixDQUFKLEVBQTZCO0FBQzNCLGNBQUksUUFBUSxRQUFRLENBQVIsQ0FBWjtBQUNBLGlCQUFPLHFCQUFXLEtBQVgsRUFBa0IsRUFBQyxVQUFVLFlBQVgsRUFBeUIsV0FBVyxhQUFwQyxFQUFsQixDQUFQO0FBQ0QsU0FIRCxNQUdPO0FBQ0wsY0FBSSxRQUFRLG9CQUFRLFdBQVIsQ0FBb0IsUUFBUSxDQUFSLENBQXBCLENBQVo7QUFDQSxnQkFBTSxJQUFOLEdBQWEsWUFBWSxRQUFRLENBQVIsRUFBVyxHQUFYLENBQWUsTUFBZixDQUFaLENBQWI7QUFDQSxnQkFBTSxLQUFOLEdBQWMsUUFBUSxDQUFSLEVBQVcsR0FBWCxDQUFlLE9BQWYsSUFBMEIsb0JBQVEsV0FBUixDQUFvQixRQUFRLENBQVIsRUFBVyxHQUFYLENBQWUsT0FBZixDQUFwQixDQUExQixHQUF5RSxTQUF2RjtBQUNBLGNBQUksTUFBTSxLQUFWLEVBQWlCO0FBQ2Ysa0JBQU0sS0FBTixDQUFZLGFBQVosR0FBNEIsb0JBQVEsV0FBUixDQUFvQixNQUFNLEtBQU4sQ0FBWSxhQUFoQyxDQUE1QjtBQUNEO0FBQ0QsaUJBQU8scUJBQVcsS0FBWCxFQUFrQixFQUFDLFVBQVUsWUFBWCxFQUF5QixXQUFXLGFBQXBDLEVBQWxCLENBQVA7QUFDRDtBQUNGLE9BZGEsRUFjWCxNQUFNLFdBQVc7QUFDbEIsZUFBTyxvQkFBTyxRQUFRLENBQVIsQ0FBUCxDQUFQO0FBQ0QsT0FoQmEsRUFOZ0IsRUFBdkIsQ0FBUDtBQXVCRDtRQUN5QixnQixHQUFsQixjO1FBQWtELFUsR0FBZCxVIiwiZmlsZSI6InNlcmlhbGl6ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHJhbnNpdCBmcm9tIFwidHJhbnNpdC1qc1wiO1xuaW1wb3J0IHtMaXN0LCBNYXB9IGZyb20gXCJpbW11dGFibGVcIjtcbmltcG9ydCBTeW50YXggZnJvbSBcIi4vc3ludGF4XCI7XG5pbXBvcnQge1N5bWJvbCwgZ2Vuc3ltLCBTeW1ib2xDbGFzc30gZnJvbSBcIi4vc3ltYm9sXCI7XG5pbXBvcnQge1Rva2VuQ2xhc3MsIFRva2VuVHlwZX0gZnJvbSBcInNoaWZ0LXBhcnNlci9kaXN0L3Rva2VuaXplclwiO1xubGV0IHR5cGVNYXBfNjMwID0gW1Rva2VuVHlwZS5TVFJJTkcsIFRva2VuVHlwZS5FT1MsIFRva2VuVHlwZS5MUEFSRU4sIFRva2VuVHlwZS5SUEFSRU4sIFRva2VuVHlwZS5MQlJBQ0ssIFRva2VuVHlwZS5SQlJBQ0ssIFRva2VuVHlwZS5MQlJBQ0UsIFRva2VuVHlwZS5SQlJBQ0UsIFRva2VuVHlwZS5DT0xPTiwgVG9rZW5UeXBlLlNFTUlDT0xPTiwgVG9rZW5UeXBlLlBFUklPRCwgVG9rZW5UeXBlLkVMTElQU0lTLCBUb2tlblR5cGUuQVJST1csIFRva2VuVHlwZS5DT05ESVRJT05BTCwgVG9rZW5UeXBlLklOQywgVG9rZW5UeXBlLkRFQywgVG9rZW5UeXBlLkFTU0lHTiwgVG9rZW5UeXBlLkFTU0lHTl9CSVRfT1IsIFRva2VuVHlwZS5BU1NJR05fQklUX1hPUiwgVG9rZW5UeXBlLkFTU0lHTl9CSVRfQU5ELCBUb2tlblR5cGUuQVNTSUdOX1NITCwgVG9rZW5UeXBlLkFTU0lHTl9TSFIsIFRva2VuVHlwZS5BU1NJR05fU0hSX1VOU0lHTkVELCBUb2tlblR5cGUuQVNTSUdOX0FERCwgVG9rZW5UeXBlLkFTU0lHTl9TVUIsIFRva2VuVHlwZS5BU1NJR05fTVVMLCBUb2tlblR5cGUuQVNTSUdOX0RJViwgVG9rZW5UeXBlLkFTU0lHTl9NT0QsIFRva2VuVHlwZS5DT01NQSwgVG9rZW5UeXBlLk9SLCBUb2tlblR5cGUuQU5ELCBUb2tlblR5cGUuQklUX09SLCBUb2tlblR5cGUuQklUX1hPUiwgVG9rZW5UeXBlLkJJVF9BTkQsIFRva2VuVHlwZS5TSEwsIFRva2VuVHlwZS5TSFIsIFRva2VuVHlwZS5TSFJfVU5TSUdORUQsIFRva2VuVHlwZS5BREQsIFRva2VuVHlwZS5TVUIsIFRva2VuVHlwZS5NVUwsIFRva2VuVHlwZS5ESVYsIFRva2VuVHlwZS5NT0QsIFRva2VuVHlwZS5FUSwgVG9rZW5UeXBlLk5FLCBUb2tlblR5cGUuRVFfU1RSSUNULCBUb2tlblR5cGUuTkVfU1RSSUNULCBUb2tlblR5cGUuTFQsIFRva2VuVHlwZS5HVCwgVG9rZW5UeXBlLkxURSwgVG9rZW5UeXBlLkdURSwgVG9rZW5UeXBlLklOU1RBTkNFT0YsIFRva2VuVHlwZS5JTiwgVG9rZW5UeXBlLk5PVCwgVG9rZW5UeXBlLkJJVF9OT1QsIFRva2VuVHlwZS5BV0FJVCwgVG9rZW5UeXBlLkRFTEVURSwgVG9rZW5UeXBlLlRZUEVPRiwgVG9rZW5UeXBlLlZPSUQsIFRva2VuVHlwZS5CUkVBSywgVG9rZW5UeXBlLkNBU0UsIFRva2VuVHlwZS5DQVRDSCwgVG9rZW5UeXBlLkNMQVNTLCBUb2tlblR5cGUuQ09OVElOVUUsIFRva2VuVHlwZS5ERUJVR0dFUiwgVG9rZW5UeXBlLkRFRkFVTFQsIFRva2VuVHlwZS5ETywgVG9rZW5UeXBlLkVMU0UsIFRva2VuVHlwZS5FWFBPUlQsIFRva2VuVHlwZS5FWFRFTkRTLCBUb2tlblR5cGUuRklOQUxMWSwgVG9rZW5UeXBlLkZPUiwgVG9rZW5UeXBlLkZVTkNUSU9OLCBUb2tlblR5cGUuSUYsIFRva2VuVHlwZS5JTVBPUlQsIFRva2VuVHlwZS5MRVQsIFRva2VuVHlwZS5ORVcsIFRva2VuVHlwZS5SRVRVUk4sIFRva2VuVHlwZS5TVVBFUiwgVG9rZW5UeXBlLlNXSVRDSCwgVG9rZW5UeXBlLlRISVMsIFRva2VuVHlwZS5USFJPVywgVG9rZW5UeXBlLlRSWSwgVG9rZW5UeXBlLlZBUiwgVG9rZW5UeXBlLldISUxFLCBUb2tlblR5cGUuV0lUSCwgVG9rZW5UeXBlLk5VTEwsIFRva2VuVHlwZS5UUlVFLCBUb2tlblR5cGUuRkFMU0UsIFRva2VuVHlwZS5ZSUVMRCwgVG9rZW5UeXBlLk5VTUJFUiwgVG9rZW5UeXBlLlNUUklORywgVG9rZW5UeXBlLlJFR0VYUCwgVG9rZW5UeXBlLklERU5USUZJRVIsIFRva2VuVHlwZS5DT05TVCwgVG9rZW5UeXBlLlRFTVBMQVRFLCBUb2tlblR5cGUuSUxMRUdBTF07XG5sZXQgTGlzdEhhbmRsZXJfNjMxID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6ICgpID0+IFwiYXJyYXlcIiwgcmVwOiB2XzYzNyA9PiB2XzYzN30pO1xubGV0IE1hcEhhbmRsZXJfNjMyID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6IGZ1bmN0aW9uICh2XzYzOCkge1xuICByZXR1cm4gXCJtYXBcIjtcbn0sIHJlcDogZnVuY3Rpb24gKHZfNjM5KSB7XG4gIHJldHVybiB2XzYzOTtcbn0sIHN0cmluZ1JlcDogZnVuY3Rpb24gKHZfNjQwKSB7XG4gIHJldHVybiBudWxsO1xufX0pO1xubGV0IFN5bnRheEhhbmRsZXJfNjMzID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6ICgpID0+IFwic3R4XCIsIHJlcDogdl82NDEgPT4ge1xuICBpZiAoTGlzdC5pc0xpc3Qodl82NDEudG9rZW4pKSB7XG4gICAgcmV0dXJuIFt2XzY0MS50b2tlbiwgdl82NDEuc2NvcGVzZXRzXTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgdCA9IHRyYW5zaXQub2JqZWN0VG9NYXAodl82NDEudG9rZW4pO1xuICAgIHQuc2V0KFwidHlwZVwiLCB0eXBlTWFwXzYzMC5pbmRleE9mKHZfNjQxLnRva2VuLnR5cGUpKTtcbiAgICByZXR1cm4gW3QsIHZfNjQxLnNjb3Blc2V0c107XG4gIH1cbn19KTtcbmxldCBTeW1ib2xIYW5kbGVyXzYzNCA9IHRyYW5zaXQubWFrZVdyaXRlSGFuZGxlcih7dGFnOiAoKSA9PiBcInN5bWJcIiwgcmVwOiB2XzY0MiA9PiBbdl82NDIubmFtZV19KTtcbmxldCB3cml0ZXJfNjM1ID0gdHJhbnNpdC53cml0ZXIoXCJqc29uXCIsIHtoYW5kbGVyczogdHJhbnNpdC5tYXAoW0xpc3QsIExpc3RIYW5kbGVyXzYzMSwgTWFwLCBNYXBIYW5kbGVyXzYzMiwgU3ludGF4LCBTeW50YXhIYW5kbGVyXzYzMywgU3ltYm9sQ2xhc3MsIFN5bWJvbEhhbmRsZXJfNjM0XSl9KTtcbmZ1bmN0aW9uIG1ha2VSZWFkZXJfNjM2KGJpbmRpbmdzXzY0Mykge1xuICByZXR1cm4gdHJhbnNpdC5yZWFkZXIoXCJqc29uXCIsIHthcnJheUJ1aWxkZXI6IHtpbml0OiBub2RlXzY0NCA9PiBMaXN0KCkuYXNNdXRhYmxlKCksIGFkZDogKHJldF82NDUsIHZhbF82NDYsIG5vZGVfNjQ3KSA9PiByZXRfNjQ1LnB1c2godmFsXzY0NiksIGZpbmFsaXplOiAocmV0XzY0OCwgbm9kZV82NDkpID0+IHJldF82NDguYXNJbW11dGFibGUoKSwgZnJvbUFycmF5OiAoYXJyXzY1MCwgbm9kZV82NTEpID0+IExpc3QoYXJyXzY1MCl9LCBtYXBCdWlsZGVyOiB7aW5pdDogZnVuY3Rpb24gKG5vZGVfNjUyKSB7XG4gICAgcmV0dXJuIE1hcCgpLmFzTXV0YWJsZSgpO1xuICB9LCBhZGQ6IGZ1bmN0aW9uIChyZXRfNjUzLCBrZXlfNjU0LCB2YWxfNjU1LCBub2RlXzY1Nikge1xuICAgIHJldHVybiByZXRfNjUzLnNldChrZXlfNjU0LCB2YWxfNjU1KTtcbiAgfSwgZmluYWxpemU6IGZ1bmN0aW9uIChyZXRfNjU3LCBub2RlXzY1OCkge1xuICAgIHJldHVybiByZXRfNjU3LmFzSW1tdXRhYmxlKCk7XG4gIH19LCBoYW5kbGVyczoge3N0eDogcmVwXzY1OSA9PiB7XG4gICAgbGV0IHNjb3Blc2V0c182NjAgPSB0cmFuc2l0Lm1hcFRvT2JqZWN0KHJlcF82NTlbMV0pO1xuICAgIGlmIChMaXN0LmlzTGlzdChyZXBfNjU5WzBdKSkge1xuICAgICAgbGV0IHRva2VuID0gcmVwXzY1OVswXTtcbiAgICAgIHJldHVybiBuZXcgU3ludGF4KHRva2VuLCB7YmluZGluZ3M6IGJpbmRpbmdzXzY0Mywgc2NvcGVzZXRzOiBzY29wZXNldHNfNjYwfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB0b2tlbiA9IHRyYW5zaXQubWFwVG9PYmplY3QocmVwXzY1OVswXSk7XG4gICAgICB0b2tlbi50eXBlID0gdHlwZU1hcF82MzBbcmVwXzY1OVswXS5nZXQoXCJ0eXBlXCIpXTtcbiAgICAgIHRva2VuLnNsaWNlID0gcmVwXzY1OVswXS5oYXMoXCJzbGljZVwiKSA/IHRyYW5zaXQubWFwVG9PYmplY3QocmVwXzY1OVswXS5nZXQoXCJzbGljZVwiKSkgOiB1bmRlZmluZWQ7XG4gICAgICBpZiAodG9rZW4uc2xpY2UpIHtcbiAgICAgICAgdG9rZW4uc2xpY2Uuc3RhcnRMb2NhdGlvbiA9IHRyYW5zaXQubWFwVG9PYmplY3QodG9rZW4uc2xpY2Uuc3RhcnRMb2NhdGlvbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFN5bnRheCh0b2tlbiwge2JpbmRpbmdzOiBiaW5kaW5nc182NDMsIHNjb3Blc2V0czogc2NvcGVzZXRzXzY2MH0pO1xuICAgIH1cbiAgfSwgc3ltYjogcmVwXzY2MSA9PiB7XG4gICAgcmV0dXJuIFN5bWJvbChyZXBfNjYxWzBdKTtcbiAgfX19KTtcbn1cbmV4cG9ydCB7bWFrZVJlYWRlcl82MzYgYXMgbWFrZURlc2VyaWFsaXplciwgd3JpdGVyXzYzNSBhcyBzZXJpYWxpemVyfTtcbiJdfQ==